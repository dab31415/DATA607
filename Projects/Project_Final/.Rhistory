season = get_season(dteday),
weekday = wday(dteday, week_start = 1) - 1,
workingday = ifelse(weekday == 0 | weekday == 6, 0, 1)) %>%
select(dteday,month,day,year,season,weekday,workingday,membership = `Member type`,cnt))
}
}
df <- data.frame()
for (y in 2018:2019) {
for (m in 1:12) {
zipfile <- paste0(y, str_pad(m, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
csvfile <- str_replace(zipfile, '.zip', '.csv')
if (!file.exists(paste0('/DATA/',csvfile))) {
print(paste0('MISSING: ','./DATA/',csvfile))
if (!file.exists(paste0('./DATA/ZIPS/',zipfile))) {
print(paste0('MISSING: ','./DATA/ZIPS/',zipfile))
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = 'DATA')
}
df <- df %>% rbind(read_csv(paste0('./DATA/',csvfile), show_col_types = FALSE) %>%
mutate(day = lubridate::day(`Start date`)) %>%
group_by(day) %>%
count(`Member type`, name = 'cnt') %>%
mutate(dteday = as.Date(paste(m,day,y, sep = '/'), '%m/%d/%Y'),
year = y,
month = m,
season = get_season(dteday),
weekday = wday(dteday, week_start = 1) - 1,
workingday = ifelse(weekday == 0 | weekday == 6, 0, 1)) %>%
select(dteday,month,day,year,season,weekday,workingday,membership = `Member type`,cnt))
}
}
df <- data.frame()
for (y in 2018:2019) {
for (m in 1:12) {
zipfile <- paste0(y, str_pad(m, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
csvfile <- str_replace(zipfile, '.zip', '.csv')
if (!file.exists(paste0('/DATA/',csvfile))) {
print(paste0('MISSING: ','/DATA/',csvfile))
if (!file.exists(paste0('./DATA/ZIPS/',zipfile))) {
print(paste0('MISSING: ','./DATA/ZIPS/',zipfile))
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = 'DATA')
}
df <- df %>% rbind(read_csv(paste0('./DATA/',csvfile), show_col_types = FALSE) %>%
mutate(day = lubridate::day(`Start date`)) %>%
group_by(day) %>%
count(`Member type`, name = 'cnt') %>%
mutate(dteday = as.Date(paste(m,day,y, sep = '/'), '%m/%d/%Y'),
year = y,
month = m,
season = get_season(dteday),
weekday = wday(dteday, week_start = 1) - 1,
workingday = ifelse(weekday == 0 | weekday == 6, 0, 1)) %>%
select(dteday,month,day,year,season,weekday,workingday,membership = `Member type`,cnt))
}
}
df <- data.frame()
for (y in 2018:2019) {
for (m in 1:12) {
zipfile <- paste0(y, str_pad(m, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
csvfile <- str_replace(zipfile, '.zip', '.csv')
if (!file.exists(paste0('.\\DATA\\',csvfile))) {
print(paste0('MISSING: ','.\\DATA\\',csvfile))
if (!file.exists(paste0('./DATA/ZIPS/',zipfile))) {
print(paste0('MISSING: ','./DATA/ZIPS/',zipfile))
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = 'DATA')
}
df <- df %>% rbind(read_csv(paste0('./DATA/',csvfile), show_col_types = FALSE) %>%
mutate(day = lubridate::day(`Start date`)) %>%
group_by(day) %>%
count(`Member type`, name = 'cnt') %>%
mutate(dteday = as.Date(paste(m,day,y, sep = '/'), '%m/%d/%Y'),
year = y,
month = m,
season = get_season(dteday),
weekday = wday(dteday, week_start = 1) - 1,
workingday = ifelse(weekday == 0 | weekday == 6, 0, 1)) %>%
select(dteday,month,day,year,season,weekday,workingday,membership = `Member type`,cnt))
}
}
file.exists('./DATA/201802-capitalbikeshare-tripdata.csv')
y
m
zipfile <- paste0(y, str_pad(m, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
csvfile <- str_replace(zipfile, '.zip', '.csv')
file.exists(paste0('./DATA/ZIPS/',zipfile))
file.exists(paste0('./DATA/',csvfile))
csvfile
file.exists(paste0('./DATA/ZIPS/',zipfile))
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = './DATA/')
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = './DATA')
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = 'DATA')
csvfile
unzip(paste0('./DATA/ZIPS/', zipfile),files = '201801*.csv', exdir = 'DATA')
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), files = csvfile, exdir = './DATA/')
}
}
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), exdir = 'DATA')
}
}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
get_season <- function(date) {
# 1 (Winter), 2 (Spring), 3 (Summer), 4 (Fall)
return ((lubridate::month(date + 10) %/% 4) + 1)
}
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), exdir = 'DATA')
}
}
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), exdir = 'DATA')
}
}
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
}
unzip(paste0('./DATA/ZIPS/',zipfile), exdir = 'DATA', overwrite = TRUE)
}
}
for (year in 2018:2019) {
for (month in 1:12) {
zipfile <- paste0(year, str_pad(month, 2, "left", "0"), "-capitalbikeshare-tripdata.zip")
if (!file.exists(paste0('./DATA/ZIPS/', zipfile))) {
download.file(paste0('https://s3.amazonaws.com/capitalbikeshare-data/', zipfile), paste0('./DATA/ZIPS/',zipfile))
unzip(paste0('./DATA/ZIPS/',zipfile), exdir = 'DATA')
}
}
}
filenames <- list.files(path = './DATA/', pattern = '20*.csv')
filenames <- list.files(path = './DATA/', pattern = '.csv$')
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
mutate(dteday = as.Date(`Start date`))
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
View(tmp)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
mutate(dteday = as.Date(`Start date`),
day = lubridate::day(`Start date`))
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
mutate(dteday = as.Date(`Start date`),
day = lubridate::day(`Start date`)) %>%
group_by(day) %>%
count(`Member type`, name = 'cnt')
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
mutate(dteday = as.Date(`Start date`)) %>%
group_by(dteday) %>%
count(`Member type`, name = 'cnt')
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
View(tmp)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(`Start date` = start_date, `Member type` = member_type) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt')
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(`Start date` = start_date, `Member type` = member_type) %>%
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(`Start date` = start_date, `Member type` = member_type)
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(`Start date` = 'start_date', `Member type` = 'member_type')
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt')
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
is.holiday <- function(date) {
holiday <- as.Date(c('2018-01-01','2018-01-15'))
return (ifelse(date %in% holidays,1,0))
}
d <- as.Date('2018-01-01')
is.holiday(d)
is.holiday <- function(date) {
holidays <- as.Date(c('2018-01-01','2018-01-15'))
return (ifelse(date %in% holidays,1,0))
}
d <- as.Date('2018-01-01')
is.holiday(d)
d <- as.Date('2018-01-02')
is.holiday(d)
is.holiday <- function(date) {
return (ifelse(date %in% holidays,1,0))
}
d <- as.Date('2018-01-02')
is.holiday(d)
holidays <- as.Date(c('2018-01-01', '2018-01-15', '2018-02-19', '2018-05-28', '2018-07-04',
'2018-09-03', '2018-10-08', '2018-11-12', '2018-11-22', '2018-12-25',
'2019-01-01', '2019-01-21', '2019-02-18', '2019-05-27', '2019-07-04',
'2019-09-02', '2019-10-14', '2019-11-11', '2019-11-28', '2019-12-25'))
d <- as.Date('2018-01-02')
is.holiday(d)
d <- as.Date('2018-01-15')
is.holiday(d)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt')
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
lubridate::wday(d, week_start = 0)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday, week_start = 1) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0)
)
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
lubridate::wday(as.Date('2018-01-01'))
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0)
)
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0),
member = ifelse(member_type == 'Member', 1, 0)
)
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
season = get_season(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0),
member = ifelse(member_type == 'Member', 1, 0))
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
season = get_season(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0),
member = ifelse(member_type == 'Member', 1, 0)) %>%
select(dtedate,
season,
yr,
mnth,
holiday,
weekday,
workingday,
member,
cnt)
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
# for (i in 1:length(filenames)) {
i <- 1
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
season = get_season(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0),
member = ifelse(member_type == 'Member', 1, 0)) %>%
select(dteday,
season,
yr,
mnth,
holiday,
weekday,
workingday,
member,
cnt)
# if needed, process tmp data frame here before appending
# append tmp data frame to df_local
#df_local <- rbind(df_local, tmp)
# }
#df_local
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
for (i in 1:length(filenames)) {
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = lubridate::year(dteday),
mnth = lubridate::month(dteday),
season = get_season(dteday),
holiday = is.holiday(dteday),
weekday = lubridate::wday(dteday) - 1,
workingday = ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0),
member = ifelse(member_type == 'Member', 1, 0)) %>%
select(dteday,
season,
yr,
mnth,
holiday,
weekday,
workingday,
member,
cnt)
df <- df %>% rbind(tmp)
}
df
filenames <- list.files(path = './DATA/', pattern = '.csv$')
df <- tibble()
for (i in 1:length(filenames)) {
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = as.integer(lubridate::year(dteday)),
mnth = as.integer(lubridate::month(dteday)),
season = as.integer(get_season(dteday)),
holiday = as.integer(is.holiday(dteday)),
weekday = as.integer(lubridate::wday(dteday) - 1),
workingday = as.integer(ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0)),
member = as.integer(ifelse(member_type == 'Member', 1, 0))) %>%
select(dteday,
season,
yr,
mnth,
holiday,
weekday,
workingday,
member,
cnt)
df <- df %>% rbind(tmp)
}
df
View(df)
get_season <- function(date) {
# 1 (Winter), 2 (Spring), 3 (Summer), 4 (Fall)
return (((lubridate::month(date + 10) - 1) %/% 3) + 1)
}
get_season(as.Date(c('2018-01-15','2018-02-15','2018-03-15','2018-04-15','2018-05-15','2018-06-15','2018-07-15','2018-08-15','2018-09-15','2018-10-15','2018-11-15','2018-12-15')))
get_season(as.Date(c('2018-01-25','2018-02-25','2018-03-25','2018-04-25','2018-05-25','2018-06-25','2018-07-25','2018-08-25','2018-09-25','2018-10-25','2018-11-25','2018-12-25')))
filenames <- list.files(path = './DATA/', pattern = '.csv')
df <- tibble()
for (i in 1:length(filenames)) {
tmp <- read_csv(paste0('./DATA/', filenames[i]), show_col_types = FALSE) %>%
rename(start_date = `Start date`, member_type = `Member type`) %>%
mutate(dteday = as.Date(start_date)) %>%
group_by(dteday) %>%
count(member_type, name = 'cnt') %>%
mutate(yr = as.integer(lubridate::year(dteday)),
mnth = as.integer(lubridate::month(dteday)),
season = as.integer(get_season(dteday)),
holiday = as.integer(is.holiday(dteday)),
weekday = as.integer(lubridate::wday(dteday) - 1),
workingday = as.integer(ifelse(holiday == 0 & weekday %in% c(1:5), 1, 0)),
member = as.integer(ifelse(member_type == 'Member', 1, 0))) %>%
select(dteday,
season,
yr,
mnth,
holiday,
weekday,
workingday,
member,
cnt)
df <- df %>% rbind(tmp)
}
df
